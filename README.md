# Wordstat Parser

Этот проект — Django приложение, которое автоматизирует сбор и анализ данных из Яндекс Wordstat. Оно использует:

- **Selenium** для взаимодействия с веб-интерфейсом Wordstat.
- **Celery** для выполнения фоновых задач.
- **Docker** для упрощения развёртывания.

## Возможности

- Автоматизированный сбор данных о популярности ключевых слов из Яндекс Wordstat.
- Обработка данных за указанный период (год и месяц).
- Определение пиковых месяцев для каждого ключевого слова.
- Сохранение результатов в Excel файл.

## Установка и запуск

### Предварительные требования

- **Docker:** Убедитесь, что Docker установлен на вашей системе. [https://www.docker.com/get-started](https://www.docker.com/get-started)
- **Python 3.12.2:** Проект разработан с использованием Python 3.12.2 (только для разработчиков, если не используется Docker).

### Шаги установки

1. **Клонируйте репозиторий:**

   ```bash
   git clone git@github.com:EvgeniiChichin/Wordstat_Parser.git
   cd your-repo
   ```

2. **Создайте виртуальное окружение Python (если не используете Docker):**

   ```bash
   python3 -m venv venv 
   source venv/bin/activate 
   ```

3. **Установите зависимости (если не используете Docker):**

   ```bash
   pip install -r requirements.txt 
   ```

4. **Создайте и заполните файл .env:**

   Скопируйте файл `.env.example` и переименуйте его в `.env`. Затем заполните переменные окружения в файле `.env` своими значениями:

   ```makefile
   FIELD_ENCRYPTION_KEY= # Сгенерируйте случайный ключ: `openssl rand -base64 32`
   SECRET_KEY= # Сгенерируйте случайный ключ: `python -c 'import secrets; print(secrets.token_urlsafe(50))'`
   EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
   EMAIL_HOST=smtp.gmail.com # Или ваш SMTP-сервер
   EMAIL_PORT=587
   EMAIL_USE_TLS=True
   EMAIL_HOST_USER= # Ваш адрес электронной почты
   EMAIL_HOST_PASSWORD= # Ваш пароль от почты
   DEFAULT_FROM_EMAIL= # Адрес отправителя писем
   SERVER_EMAIL= # Адрес отправителя системных писем
   EMAIL_ADMIN= # Адрес администратора
   ```

5. **Соберите Docker образы:**

   ```bash
   docker-compose build
   ```

6. **Запустите Docker контейнеры:**

   ```bash
   docker-compose up -d
   ```

7. **Примените миграции базы данных:**

   ```bash
   docker-compose exec web python manage.py migrate
   ```

8. **Создайте суперпользователя:**

   ```bash
   docker-compose exec web python manage.py createsuperuser
   ```
## Доступ к приложению (локальный запуск с Docker Compose)

По  умолчанию  приложение  настроено  для  доступа  по  адресу  `http://localhost`.  Однако,  если  вы  хотите  получить  доступ  к  приложению  с  другого  устройства  в  той  же  сети  (например,  с  телефона  или  другого  компьютера),  вам  нужно  использовать  IP-адрес  вашего  компьютера.

Чтобы  найти  свой  IP-адрес:

**Linux/Mac:**

```bash
ifconfig | grep "inet " | grep -Fv 127.0.0.1 | awk '{print $2}'
```

**Windows:**

```bash
ipconfig | findstr /i "IPv4"
```

После  того  как  вы  нашли  свой  IP-адрес,  вы  можете  использовать  его  для  доступа  к  приложению,  например:  `http://192.168.x.x`.

Также  не  забудьте  добавить  этот  IP-адрес  в  список  `ALLOWED_HOSTS`  в  файле  настроек  Django  (`settings.py`):

```python
ALLOWED_HOSTS = ['localhost', '127.0.0.1', '192.168.x.x']  #  Замените  192.168.x.x  на  свой  IP-адрес
```
**Таким  образом,  приложение  будет  доступно  как  по  адресу  `http://localhost`,  так  и  по  вашему  IP-адресу.**

## Использование

1. **Зарегистрируйтесь или войдите в систему.**

2. **Установите куки Яндекса:**
   - Перейдите на страницу "Установить куки Яндекса".
   - Введите значения `Session_id` и `yandexuid` из своего браузера.
   - Нажмите "Сохранить".

3. **Загрузите Excel файл с запросами Wordstat:**
   - Перейдите на страницу "Загрузить файл".
   - Выберите файл Excel с вашими запросами.
   - Укажите параметры загрузки (имя листа, период, столбцы и т.д.).
   - Нажмите "Загрузить".

4. **Дождитесь завершения обработки файла:**
   - Приложение запустит фоновую задачу Celery для обработки файла.
   - Вы можете отслеживать статус задачи на странице "Проверить статус".

5. **Скачайте обработанный Excel файл:**
   - Когда задача будет завершена, вы сможете скачать обработанный Excel файл, в котором будут содержаться данные Wordstat для ваших запросов.

## Логирование

Логи приложения записываются в файлы в папке `logs`:

- `general.log`: Логи Django приложения.
- `celery.log`: Логи Celery задач.
- `error.log`: Логи ошибок.

## Настройка Celery

Проект использует Celery для выполнения фоновых задач. Количество воркеров Celery можно настроить в файле `docker-compose.yml`. Для обработки задач в условиях одновременного использования 10 пользователей рекомендуется установить количество воркеров так, чтобы обеспечить достаточную производительность.

По умолчанию в файле `docker-compose.yml` указано следующее количество воркеров:

```yaml
celery:
  build: .
  command: celery -A wordstat_project worker -l info -c 3
```

Здесь `-c 3` указывает, что будет запущено 3 воркера. Если вы ожидаете одновременное использование от 10 пользователей, возможно, потребуется увеличить это число в зависимости от объема и сложности задач. Например, вы можете попробовать увеличить количество воркеров до 5-10:

```yaml
celery:
  build: .
  command: celery -A wordstat_project worker -l info -c 5
```

Корректное количество воркеров зависит от нагрузки на систему и доступных ресурсов. Рекомендуется проводить тестирование и мониторинг производительности для оптимальной настройки.

## Дополнительная информация

- Проект использует geckodriver для управления браузером Firefox в Selenium. Убедитесь, что у вас установлена совместимая версия Firefox и geckodriver.
- Вы можете настроить параметры логирования в файле `logging_config.py`.

## Развертывание на сервере

1. **Установите Docker на  сервер:**  
   - Убедитесь,  что  Docker  и  Docker Compose  установлены  на  вашем  сервере.

2. **Настройте SSL сертификат:**  
   - Чтобы  обеспечить  безопасное  соединение,  настройте  SSL  сертификат  для  HTTPS.  Обратитесь  к  документации  по  настройке  SSL  для  вашего  веб-сервера  (например,  Nginx). 

3. **Обновите конфигурацию Nginx:**  
   - Убедитесь,  что  ваш  веб-сервер  (например,  Nginx)  настроен  для  работы  с  HTTPS  и  проксирует  запросы  к  вашему  Django  приложению. 

4. **Запустите Docker контейнеры на сервере:**

   ```bash
   docker-compose up -d
   ```

5. **Проверьте  работу  приложения:**
   - После  развёртывания  проверьте,  что  приложение  доступно  через  HTTPS  и  что  все  функции  работают  корректно.

## Контактная информация
Проект разработан и поддерживается [Evgenii Chichin](https://github.com/EvgeniiChichin) . Если у вас есть вопросы или предложения по улучшению проекта, вы можете связаться со мной через GitHub или отправить запросы на изменения.

Благодарю вас за использование Wordstat Parser! Надеюсь, этот инструмент окажется полезным для ваших задач. Удачи в работе с данными!
